{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "24eedc53_211c8129",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-08-04T08:43:25Z",
      "side": 1,
      "message": "I do not like `Type` field to be templated or otherwise variable.\n`Type` field is what is used by people to find the schema and create the dbus interfaces name.\n\nSo for both purposes `Type` should be fixed. Maybe topology schema needs to be reworked. Not sure how to go about this but could we extend `DownstreamPort` with an optional `ConnectsToName` property.\n\nFrom my understanding the ports are only consumed by EM to create the associations, so we should be free to make changes there?",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f0c330c_35069961",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1001354
      },
      "writtenOn": "2025-08-04T16:34:27Z",
      "side": 1,
      "message": "I would wholeheartedly agree if we were starting from scratch -- but a complicating factor is that current association handling for the powering/powered_by example in association.md explicitly says\n\n\u003ethe Type fields for those ports match up with the ConnectsToType field from the PSUs.\n\nhttps://github.com/openbmc/entity-manager/blob/master/docs/associations.md\n\n\nand there\u0027s a small handful of EMConfigs using it in templated form as described today:\n\nhttps://github.com/search?q\u003drepo%3Aopenbmc%2Fentity-manager%20path%3A%2F%5Econfigurations%5C%2F%2F%20downstream\u0026type\u003dcode\n\nI think if we changed how that works for cooling/cooled_by, we\u0027d probably want to change it for powering/powered_by too -- but I\u0027m not sure what the appetite for backtesting changes there would be.",
      "parentUuid": "24eedc53_211c8129",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "464f2f9e_05599c74",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-08-05T18:58:32Z",
      "side": 1,
      "message": "\u003e and there\u0027s a small handful of EMConfigs using it in templated form as described today:\n\nOnly 3 configs. Can be fixed even manually without script ðŸ˜Š.\n\n\n\u003e I think if we changed how that works for cooling/cooled_by, we\u0027d probably want to change it for powering/powered_by too -- but I\u0027m not sure what the appetite for backtesting changes there would be.\n\nSince the design intent is to create the association, i am doubting there are any external consumers (of the configuration, not the association)  github code search could be helpful there.",
      "parentUuid": "1f0c330c_35069961",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "571efd81_33c233b4",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 137,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-08-04T08:43:25Z",
      "side": 1,
      "message": "`ConnectsToType` here does not match with `DownstreamPort` schema currently.\nIt only accepts\n```\n                \"ConnectsToType\": {\n                    \"description\": \"Should be equal to the \u0027Type\u0027 property on the upstream port\",\n                    \"type\": \"string\",\n                    \"const\": \"MB Upstream Port\"\n                },\n```",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a9a933ae_15a28aec",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 137,
      "author": {
        "id": 1001354
      },
      "writtenOn": "2025-08-04T16:34:27Z",
      "side": 1,
      "message": "Thanks for pointing that out -- I\u0027ve only recently started looking more clossely at the Entity-Manger schema side of things.\n\nHere\u0027s a recently added change to the topology.json that I believe should address that issue\n\nhttps://gerrit.openbmc.org/c/openbmc/entity-manager/+/82408/5/schemas/topology.json",
      "parentUuid": "571efd81_33c233b4",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "348bf904_44c87ff5",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 137,
      "author": {
        "id": 1001354
      },
      "writtenOn": "2025-08-05T16:07:35Z",
      "side": 1,
      "message": "Oh shoot - my eyes must have glazed over on the \u0027cost: MB Upstream Port\u0027 line and it\u0027s implications.\n\nI thought you were pointing out the lack of \u0027FanPort\u0027 in the current schema.\n\nI\u0027ll have to dig in and think about this more, but my current thinking is that the schema should be updated to remove the \u0027const\u0027 (or change it to an enum?) since \n\nA) it contradicts the examples given in associations.md\n\nB) would mean there could only be 1 port per chassis to be shared by all PSU, fans, or any \u0027contains by\u0027 associations people might want to setup -- right?",
      "parentUuid": "a9a933ae_15a28aec",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "91cc3ecf_6d2a66ff",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 137,
      "author": {
        "id": 1000008
      },
      "writtenOn": "2025-08-05T16:19:32Z",
      "side": 1,
      "message": "I think if necessary there should be able to be 1-1 correspondence between EM ports and physical connectors, hence the name physical topology as opposed to logical.  So far that just hasn\u0027t been necessary.\n\nI have far future hopes of hanging IBM\u0027s connector location codes off of these ports, and so would use unique ports that would be exposed even when no child is plugged.  TBD if I\u0027ll ever get there though.",
      "parentUuid": "348bf904_44c87ff5",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6b1b9527_f51fa870",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 137,
      "author": {
        "id": 1001354
      },
      "writtenOn": "2025-08-05T18:36:46Z",
      "side": 1,
      "message": "\u003eI think if necessary there should be able to be 1-1 correspondence between EM ports and physical connectors\n\nThat sounds like the EMConfig update I\u0027ll be adding to this PR for discussion - one \u0027fan N port\u0027 per fan.\n\nAnd seems to line up with what I\u0027m finding in the physical topology design doc @ http://github.com/openbmc/docs/blob/master/designs/physical-topology.md#entity-manager\n\n\u003eThe upstream port has a type ending in Port (such as a BackplanePort, PowerInputPort, etc). The downstream port has type DownstreamPort and a ConnectsToType property that refers to the upstream port based on its type\n\nBased on that, I\u0027m thinking I should go ahead and update the topology.json schema to use something like:\n\n\"type\": \"string\",\n\"pattern\": \"^.*Port$\"\n\nfor the Port-\u003eType and Downstream-\u003eConnectsToType instead of enum and const.",
      "parentUuid": "91cc3ecf_6d2a66ff",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5aba509c_ec1bb801",
        "filename": "docs/associations.md",
        "patchSetId": 5
      },
      "lineNbr": 137,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-08-05T18:58:32Z",
      "side": 1,
      "message": "\u003e The upstream port has a type ending in Port (such as a BackplanePort, PowerInputPort, etc). The downstream port has type DownstreamPort and a ConnectsToType property that refers to the upstream port based on its type\n\nIf we make `Type` a pattern then it will break PDI compatibility.\n\nSince `Type` is used to create the DBus interface name. It is a special property (just like `Name`) and we cannot just use it for any purpose.\n\n\u003e The upstream port has a type ending in Port (such as a BackplanePort, PowerInputPort, etc). The downstream port has type DownstreamPort and a ConnectsToType property that refers to the upstream port based on its type\n\nThe design is from 2022\n\nSo i see at least 5 choices here\n\n(1) make a (possibly large) enum with `BackplanePort1`, `BackplanePort2`, ...\n    (not happy)\n\n(2) make object mapper support regex\n    (not happy)\n\n(3) introduce new schema with fixed `Type` field\n\n(4) fix old schema to make it less cursed\n\n(5) introduce a quirk into EM to not expose any configurations from this schema externally\n    (not happy)",
      "parentUuid": "6b1b9527_f51fa870",
      "revId": "bef153daf219b4e79b0f3a57443c5e6816f81b36",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}