{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8d42c87d_edb4e760",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-06T10:08:44Z",
      "side": 1,
      "message": "Can you revert 7962944f072b54e22075e8290e1e6708bdb30c38 locally and check if it fixes the issue üòä\n\nIn which case we can note in the commit message that the bug was introduced there. Might help to get some context about this change.",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c6d44c8_e2339db1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1002520
      },
      "writtenOn": "2025-10-07T07:31:02Z",
      "side": 1,
      "message": "Thanks for pointing that out. I added it in the footer. Is that okay?\n\n`Fixes: I4499baf3ebe9560e13932a49e324d1c8b0255623`",
      "parentUuid": "8d42c87d_edb4e760",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4247c0c0_be849b1c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-07T11:44:51Z",
      "side": 1,
      "message": "Thanks üëç",
      "parentUuid": "5c6d44c8_e2339db1",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "07942642_6b365b0f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2025-10-03T19:33:08Z",
      "side": 1,
      "message": "I\u0027m pretty sure this is the Nth copy of this same code being proposed.  Can we pick something as the fix we\u0027re going to go with?  This is a seriously irritating bug.\n\nIf we don\u0027t like the solution, can we give concrete direction on what we\u0027d like to do as the solution?",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "36b7923d_008eb680",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-06T10:08:44Z",
      "side": 1,
      "message": "Looks like https://gerrit.openbmc.org/c/openbmc/entity-manager/+/82998 broke something (regex `$` removed at the end).\n\n@chaul@amperecomputing.com had another version of that patch (see PS6) which replaced syntax of `$bus` with `${bus}` which does not have the issue observed here.\n\nAnother benefit of that version of her patch was that the boundary of a template var is clearly defined so there is no conflict in case a template var is a prefix of another template var.\n\nThe sticking point seemed to be the format change https://discordapp.com/channels/775381525260664832/1402479981111676978/1415571530716549160\n\nMaybe the proposed fix can work for now but long-term it would be better to have something like `${...}` which ChauLy had initially and/or to go with some kind of parser which Ed had an old patch for.",
      "parentUuid": "07942642_6b365b0f",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6bc83cc3_c1ac66db",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2025-10-07T03:11:23Z",
      "side": 1,
      "message": "My concern finally become a bug. That\u0027s why in the first place I wanted the vars to have boundary. I\u0027m still with the ${var} direction, though if I need to suggest a solution. Please let me know what I should do to address this bug from my previous commit.",
      "parentUuid": "36b7923d_008eb680",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0a8bb63b_06a240b9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002520
      },
      "writtenOn": "2025-10-07T08:12:14Z",
      "side": 1,
      "message": "The case you mentioned also occurs on Ventura.\nIt triggers an error message like:\n```log\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n```\nThe JSON files that contain this issue are:\nconfigurations/meta/ventura/ventura_fanboard_*.json\n\nThis patch only addresses the issue caused by the regex dollar-sign expression.",
      "parentUuid": "6bc83cc3_c1ac66db",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "66faf4b8_d7614d78",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2025-10-07T09:35:56Z",
      "side": 1,
      "message": "\u003e The case you mentioned also occurs on Ventura.\nIt triggers an error message like:\n\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\nHi @eldin.lee@quantatw.com, I don\u0027t understand why $bus falls into this check. Shouldn\u0027t all $bus be replaced by BUS property?",
      "parentUuid": "0a8bb63b_06a240b9",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "97698968_f02245f6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1002520
      },
      "writtenOn": "2025-10-07T13:19:38Z",
      "side": 1,
      "message": "After adding the debug logs, it seems handleLeftOverTemplateVars() is actually catching real user mistakes.\n\n```log\n\u003c7\u003e String value: `FCB_0 FAN_$bus % 2 * 2 VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\n\u003c7\u003e String value: `FCB_0 FAN_$bus % 2 * 2 IMON_VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\n\u003c7\u003e String value: `FCB_0 FAN_$bus % 2 * 2 + 1 VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\n\u003c7\u003e String value: `FCB_0 FAN_$bus % 2 * 2 + 1 IMON_VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\n\u003c7\u003e String value: `FCB_1 FAN_$bus % 2 * 2 VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\n\u003c7\u003e String value: `FCB_1 FAN_$bus % 2 * 2 IMON_VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\n\u003c7\u003e String value: `FCB_1 FAN_$bus % 2 * 2 + 1 VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n\n\u003c7\u003e String value: `FCB_1 FAN_$bus % 2 * 2 + 1 IMON_VOLT_V`\n\u003c3\u003e There\u0027s still template variable $bus un-replaced. Removing it from the string.\n```\n\nbusctl introspect xyz.openbmc_project.EntityManager  /xyz/openbmc_project/inventory/system/board/Ventura_Fan_Board_0/FAN_ADC\n\nHere‚Äôs part of the busctl introspection result for reference:\n```\nxyz.openbmc_project.Configuration.ADC128D818             interface -         -                                    -\n.Address                                                 property  t         31                                   emits-change\n.Bus                                                     property  t         16                                   emits-change\n.Labels                                                  property  as        4 \"in0\" \"in1\" \"in2\" \"in3\"            emits-change\n.Name                                                    property  s         \"FAN_ADC\"                            emits-change\n.Type                                                    property  s         \"ADC128D818\"                         emits-change\n.in0_Max                                                 property  t         18                                   emits-change\n.in0_Name                                                property  s         \"FCB_0 FAN_ % 2 * 2 VOLT_V\"          emits-change\n.in0_Scale                                               property  d         133.262                              emits-change\n.in1_Name                                                property  s         \"FCB_0 FAN_ % 2 * 2 IMON_VOLT_V\"     emits-change\n.in1_Scale                                               property  t         1                                    emits-change\n.in2_Max                                                 property  t         18                                   emits-change\n.in2_Name                                                property  s         \"FCB_0 FAN_ % 2 * 2 + 1 VOLT_V\"      emits-change\n.in2_Scale                                               property  d         133.262                              emits-change\n.in3_Name                                                property  s         \"FCB_0 FAN_ % 2 * 2 + 1 IMON_VOLT_V\" emits-change\n\n```",
      "parentUuid": "66faf4b8_d7614d78",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8c160bac_95c5554f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-07T14:07:45Z",
      "side": 1,
      "message": "```\n[alexander@alexanderarchlinux ventura]$ rg -B 2 -A 2  Probe ventura_fan*\nventura_fanboard_adc_max.json\n60-        ],\n61-        \"Name\": \"Ventura Fan Board $bus % 2\",\n62:        \"Probe\": \"xyz.openbmc_project.FruDevice({\u0027BOARD_MANUFACTURER\u0027: \u0027(Quanta|Ingrasys)\u0027, \u0027BOARD_PRODUCT_NAME\u0027: \u0027Ventura FAN Board\u0027, \u0027BOARD_INFO_AM4\u0027: \u0027adc-max\u0027})\",\n63-        \"Type\": \"Board\",\n64-        \"xyz.openbmc_project.Inventory.Decorator.Asset\": {\n\nventura_fanboard_adc_ocp_max.json\n60-        ],\n61-        \"Name\": \"Ventura Fan Board $bus % 2\",\n62:        \"Probe\": \"xyz.openbmc_project.FruDevice({\u0027BOARD_MANUFACTURER\u0027: \u0027Quanta\u0027, \u0027BOARD_PRODUCT_NAME\u0027: \u0027Ventura FAN Board\u0027, \u0027BOARD_INFO_AM4\u0027: \u0027adc-ocp-max\u0027})\",\n63-        \"Type\": \"Board\",\n64-        \"xyz.openbmc_project.Inventory.Decorator.Asset\": {\n\nventura_fanboard_adc_ocp_tic.json\n60-        ],\n61-        \"Name\": \"Ventura Fan Board $bus % 2\",\n62:        \"Probe\": \"xyz.openbmc_project.FruDevice({\u0027BOARD_MANUFACTURER\u0027: \u0027Quanta\u0027, \u0027BOARD_PRODUCT_NAME\u0027: \u0027Ventura FAN Board\u0027, \u0027BOARD_INFO_AM4\u0027: \u0027adc-ocp-tic\u0027})\",\n63-        \"Type\": \"Board\",\n64-        \"xyz.openbmc_project.Inventory.Decorator.Asset\": {\n\nventura_fanboard_adc_tic.json\n60-        ],\n61-        \"Name\": \"Ventura Fan Board $bus % 2\",\n62:        \"Probe\": \"xyz.openbmc_project.FruDevice({\u0027BOARD_MANUFACTURER\u0027: \u0027(Quanta|Ingrasys)\u0027, \u0027BOARD_PRODUCT_NAME\u0027: \u0027Ventura FAN Board\u0027, \u0027BOARD_INFO_AM4\u0027: \u0027adc-tic\u0027})\",\n63-        \"Type\": \"Board\",\n64-        \"xyz.openbmc_project.Inventory.Decorator.Asset\": {\n```\n\nso all fanbord configs for ventura probe on FruDevice interface, it should always have the `$bus` property, right?\n\nDo you think there is another bug here besides the trailing `$` thing.",
      "parentUuid": "97698968_f02245f6",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f69e0d89_acaa8691",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 104,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-06T10:08:44Z",
      "side": 1,
      "message": "Since we are introducing another branch here, i assume we need a unit test to make the fix last longer.",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ea69776b_7e335b92",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 104,
      "author": {
        "id": 1002520
      },
      "writtenOn": "2025-10-07T07:31:02Z",
      "side": 1,
      "message": "I‚Äôve added a unit test to make sure the fix lasts.\nWhile testing, I noticed that the `$\"` case wouldn‚Äôt happen, so I removed it.",
      "parentUuid": "f69e0d89_acaa8691",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "67112c1e_755efb8a",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 104,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-07T11:44:51Z",
      "side": 1,
      "message": "Thanks üëç",
      "parentUuid": "ea69776b_7e335b92",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5fdb2166_80f11089",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2025-10-07T03:11:23Z",
      "side": 1,
      "message": "How about we check the var length here before treating it as an error? In the regex case, std::string(findStart.begin(), templateVarEnd) should be 1 character long only, right? That means it only contains the \"$\" character.\n\nWhat do you think about this @alexander.hansen@9elements.com?",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "862c46c8_a0d3abf5",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1002520
      },
      "writtenOn": "2025-10-07T07:31:02Z",
      "side": 1,
      "message": "I think `handleLeftOverTemplateVars` should still detect cases where a dollar sign is left by mistake.\nThe regex case is quite specific, so I‚Äôd prefer to just add an exception for that.",
      "parentUuid": "5fdb2166_80f11089",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e10b4b66_d29964ee",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1001526
      },
      "writtenOn": "2025-10-07T09:35:56Z",
      "side": 1,
      "message": "I can\u0027t think of a scenario where a dollar sign is left at the end of a word (\"Some$ random thing\"). If there is, maybe it\u0027s user\u0027s intention.",
      "parentUuid": "862c46c8_a0d3abf5",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0835218a_17d2f012",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-10-07T11:44:51Z",
      "side": 1,
      "message": "\u003e How about we check the var length here before treating it as an error?\n\nSounds like a good fix for the observed issue.\n\n\u003e I think handleLeftOverTemplateVars should still detect cases where a dollar sign is left by mistake.\n\nIf there is any mistake in the config file, it is the user\u0027s fault and the user can  fix their config file.\n\nHow would we detect if the `$` is there by mistake or on purpose?",
      "parentUuid": "e10b4b66_d29964ee",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c63a0bc0_f2947ca6",
        "filename": "src/entity_manager/utils.cpp",
        "patchSetId": 1
      },
      "lineNbr": 135,
      "author": {
        "id": 1002520
      },
      "writtenOn": "2025-10-07T12:34:49Z",
      "side": 1,
      "message": "I‚Äôm sorry, I didn‚Äôt provide enough details earlier, which might have caused some misunderstanding.\n```cpp\n        // Skip this case to avoid false errors caused by regex \u0027$\u0027 anchors\n        auto firstCharIt \u003d std::next(findStart.begin());\n        if (firstCharIt !\u003d strPtr-\u003eend() \u0026\u0026 *firstCharIt \u003d\u003d \u0027\\\u0027\u0027)\n        {\n            lg2::info(\"String value: `{STR}`\", \"STR\", *strPtr);\n            break;\n        }\n```\noutput:\n```log\n\u003c6\u003e String value: `xyz.openbmc_project.Inventory.Source.DevicePresence({\u0027Name\u0027: \u0027^RPU1LeakPort1$\u0027})`\n```\n\nThe case I mentioned isn‚Äôt about having a dollar sign in plain text like `Some$ random thing`, but rather about regex expressions such as `xyz.openbmc_project.Inventory.Source.DevicePresence({\u0027Name\u0027: \u0027^RPU1LeakPort1$\u0027})`, where `$` is a valid end-of-line anchor. \nThose were being falsely reported as leftover template variables.\n\n\u003e If there is any mistake in the config file, it is the user\u0027s fault and the user can fix their config file.\n\u003e How would we detect if the $ is there by mistake or on purpose?\n\nActually, I have the same question. If we simply skip every `$`, we might also miss real cases where the user accidentally left a `$` by mistake.\nThat‚Äôs why I only handled the specific `$\u0027` case.",
      "parentUuid": "0835218a_17d2f012",
      "revId": "a8d2bb0d8a4ca5be6c3ee607af21d235533fa50b",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}