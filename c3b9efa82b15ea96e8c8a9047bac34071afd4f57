{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "963a2c23_93b54370",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 12,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2026-02-12T02:36:22Z",
      "side": 1,
      "message": "I\u0027m not really following what we\u0027re doing here.  These schemas govern the json, which I would expect to be consistent in type (we can debate string or int).  Generally we wouldn\u0027t move from string to int because that now requires that we can\u0027t do math (because the existing expression engine isn\u0027t the best).  It\u0027s not clear to me what this accomplishes, and certainly I\u0027m not interested in having both be allowed at a json level.",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 12,
        "endChar": 42
      },
      "revId": "c3b9efa82b15ea96e8c8a9047bac34071afd4f57",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bc5d3c2e_defe12fc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1000008
      },
      "writtenOn": "2025-11-10T19:16:56Z",
      "side": 1,
      "message": "How would the reactor know which one it is?",
      "revId": "c3b9efa82b15ea96e8c8a9047bac34071afd4f57",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0c3b7b89_8eb2be00",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2025-11-10T19:24:47Z",
      "side": 1,
      "message": "Ideally it should _only_ be a number, but due to the way any \"$bus\"-like statements are in the EM config, you have to have string for nearly everything.  I think it gets converted back to a number for dbus though.\n\nI looked at a device that had an instance of `clemente_scm.json` and the Configuration.EEPROM had both `t` as the type for Address and Bus, when I do a `busctl introspect`.  But, in legacy.json, Address is defined as just `string` and Bus is `[string, number]`",
      "parentUuid": "bc5d3c2e_defe12fc",
      "revId": "c3b9efa82b15ea96e8c8a9047bac34071afd4f57",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b6a2cbf3_5e40472c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-11-11T09:23:43Z",
      "side": 1,
      "message": "EM does not know about the DBus type when we configure with string.\nIt looks at the string at runtime and does a duck typing based on whatever it evaluates to.\n\nSo if there are no template vars and no operators like `+` then EM may just put a string on DBus and possibly crash the reactor.\n\njson-schema cannot represent this information.\n\nWe may need our own data structure in EM to represent what we need out of a schema:\n\n- name of property\n- type of property in config json\n- type of property on DBus (current solution cannot represent this)\n- optional/required property\n\nCurrently we use json-schema in a very specific way and we only need a small subset of it\u0027s features.\n\n@ed@tanous.net would you be ok with replacing json schema with our own json based solution here to solve these issues?\n\nWhat\u0027s your take on this, how do we teach EM which type is to be used at runtime for a given property?",
      "parentUuid": "0c3b7b89_8eb2be00",
      "revId": "c3b9efa82b15ea96e8c8a9047bac34071afd4f57",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10f85786_82f25386",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2026-02-12T02:36:22Z",
      "side": 1,
      "message": "You can\u0027t really map dbus to the json schemas directly.  The logic for \"is this a number\" conversion is bonkers (and to be clear, should be fixed) but string is the safer of the two options, because EM devolves everything back to a string.\n\n\u003e our own data structure\n\nI really don\u0027t want to maintain per-property data structures.  FWIW, even the json schema implies a level of type safety that people rely on and fail because they didn\u0027t test.  As much as I dislike DRY sometimes, I think it applies here, needing to add an EM config, a json schema, a backend implementation, possibly a PDI config, and now a new structure for a single property is a development model that I don\u0027t think is very efficient and I\u0027m not sure I could support.\n\nIf we want to make changes in this area, I think the simplest would be \"everything is a string\" at dbus level.  Languages like TCL do this.  Some strings will look a lot like integers/hex and can be interpreted in the daemon as such.  Most EM daemons already interpret an \"number like\" string property as a number.  That way we\u0027re not trying to write per property conversions, and the config APIs look sane without needing yet another place we need to document each property.",
      "parentUuid": "b6a2cbf3_5e40472c",
      "revId": "c3b9efa82b15ea96e8c8a9047bac34071afd4f57",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6907d5a_0ec9672a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 13,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-02-13T03:42:07Z",
      "side": 1,
      "message": "\u003e level of type safety that people rely on and fail because they didn\u0027t test. \n\nI just don\u0027t get why configuration has to be so difficult. It\u0027s 101 of application programming. You have a config property, which has an expected type. No need for duck typing.\n\nEither the value has the expected type or there\u0027s a conversion error which is logged and the config is discarded. That\u0027s it. very simple.\n\nNo need to pass on the config parsing and type conversion problems onto reactors - since that is part of entity-manager\u0027s responsibility.\n\nSince there\u0027s a bunch of reactors but only one entity-manager, it makes sense to solve config parsing problems in entity-manager to prevent unnecessary code duplication.\n\n\u003e As much as I dislike DRY sometimes, I think it applies here, needing \nto add an EM config, a json schema, a backend implementation, possibly a\n PDI config, and now a new structure for a single property is a \ndevelopment model that I don\u0027t think is very efficient and I\u0027m not sure I\n could support.\n\nWhat would change for the config schema author is that they would have to specify the D-Bus type in addition to what they have to specify currently.\nSomething like `\"D-Bus-Type\": \"uint32\"` (or whichever char that\u0027s in D-Bus notation).\n\nI don\u0027t get why this is such a big problem since config schema authors already know which type to use since they have to parse that on the reactor side.\n\n\u003e If we want to make changes in this area, I think the simplest would be \"everything is a string\" at dbus level.\n\nentity-manager is already plenty slow without converting everything to string.\nYour suggestion would both increase runtime and memory consumption on entity-manager side and runtime (parsing overhead) on reactor side in addition to duplicating type conversion and associated error handling code across all reactors.",
      "parentUuid": "10f85786_82f25386",
      "revId": "c3b9efa82b15ea96e8c8a9047bac34071afd4f57",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}