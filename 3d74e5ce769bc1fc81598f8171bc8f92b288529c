{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "28d58818_c5b02511",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-06-12T18:14:25Z",
      "side": 1,
      "message": "As written, this would now make all Tyan boards stop detecting add in cards, hsbps or other devices that would otherwise be compatible?  It\u0027s difficult to tell if that\u0027s the intent.",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fff5c896_ba5eee3e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-06-13T08:48:42Z",
      "side": 1,
      "message": "The configuration which is to be installed is determined by the meson option.\n\nIt\u0027s something to configure when building a firmware image.\nThe configuration files themselves only declare which type of hardware or which specific hardware they are compatible with.\n\nThen later when building the EM we can select which hardware it should support.\n\nSo \"what is supported\" by EM is determined by whoever is building the BMC firmware image.",
      "parentUuid": "28d58818_c5b02511",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "357b2ff9_e3d7422b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-06-24T17:16:35Z",
      "side": 1,
      "message": "\u003e by EM is determined by whoever is building the BMC firmware image.\n\nI really have no idea what you mean by this.  You\u0027re adding a meson option that removes the config files for all the pcie devices, for boards that have PCIe slots.\n\nHow would one building the bmc image \"determine\" which hardware should be supported?  How is that (likely very large) list maintained?",
      "parentUuid": "fff5c896_ba5eee3e",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b377adf1_e4ab34e3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-06-26T10:20:07Z",
      "side": 1,
      "message": "\u003e You\u0027re adding a meson option that removes the config files for all the pcie devices, for boards that have PCIe slots.\n\nThe option *does nothing* unless you configure it.\n\nAnyone who does configure it may want to adjust the configurations which they need for their platform. Clarified this point by adding the ```CompatibleHardware``` property to some PSU configurations as well which i need for my use-case.\n\nThis (figuring out compatibility for many components) is not something i want to do in a single commit.\n\nFor my use-case i do not need the pcie configs, as none of them probes true for my hardware configuration.\n\nSo if i configure the option as ```tyan-s8030 psu-1u``` then it will be ideal for my use-case. I will have all the configurations i need and zero bloat.\n\n\u003e How would one building the bmc image \"determine\" which hardware should be supported? How is that (likely very large) list maintained?\n\nThey can determine which hardware the platform has based on BOM, schematics, and devicetree.\n\nIf there are multiple platforms to be supported then they can make a union.\n\n\nIf the platform is general-purpose and not a fixed configuration (e.g. for sale to various customers doing who-knows-what with the platform) then the meson option should be left as default.\n\n\nIf the platform is fixed from the hardware side and will not be changed, then go via the 4-step process:\n- option as default\n- see which configs probe true\n- check these should have a ```CompatibleHardware``` property\n- configure the option to match the actual hardware",
      "parentUuid": "357b2ff9_e3d7422b",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02cb8018_c6db359d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-06-26T16:53:28Z",
      "side": 1,
      "message": "\u003e for their platform\n\nThis would mean it goes in an meta layer config for that platform?  Who determines for tyan (Which I also have boards that I used regularly), which PCIe cards are supported?  This is the problem for normal boards that multiple people might have.\n\n\u003e For my use-case i do not need the pcie configs\n\nRight... but others (including me) do.  How do you separate the idea of a hardware image itself from what is supported.  This patch as a whole breaks that idea, and now fragments things.\n\n\u003e They can determine which hardware the platform has based on BOM, schematics, and devicetree.\n\nOk, so the tyan boards you have changed have support for several PCIe ports, NVMe drives, and other things that this config has disabled.  That\u0027s broken in my opinion.\n\n\u003e If the platform is fixed from the hardware side and will not be changed, then go via the 4-step process:\n\nPlatforms are not fixed.  Add in cards are added/removed all the time.  We cannot be hardcoding a single config in EM.  If you want to do that, phosphor-inventory is the tool to use for a \"I know all things about the config at compile time\" use cases.",
      "parentUuid": "b377adf1_e4ab34e3",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0c2ed5c_2134f096",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-06-26T20:17:55Z",
      "side": 1,
      "message": "\u003e This would mean it goes in an meta layer config for that platform? Who determines for tyan (Which I also have boards that I used regularly), which PCIe cards are supported? This is the problem for normal boards that multiple people might have.\n\n```meta-tyan``` should probably not configure the option at all. From my perspective it is a community layer.\n\nFor example in one of the downstreams i am contributing to, we have a meta-layer on top of meta-tyan. In such a layer it makes sense to have such an option since we know all system configurations we are building the image for.\n\n```meta-facebook``` may want to configure it for some boards.\n\nFor other meta-layers i cannot really say much, but the qemu targets could benefit as well.\n\nIt depends on what the layer is trying to accomplish. If it\u0027s a board support layer\nthen it should probably not configure it.\n\nIf it\u0027s a meta-layer which is used to create a custom image for a specific application, then the option can be configured.\n\n\u003e Right... but others (including me) do. \n\nAnd everyone can configure (or not configure) the option as they like ðŸ˜Š\n\n\u003e Ok, so the tyan boards you have changed have support for several PCIe ports, NVMe drives, and other things that this config has disabled. That\u0027s broken in my opinion.\n\nThe ```CompatibleHardware``` property in the json config has no effect on it\u0027s own.\nIt only has an effect if the meson option is configured to something other than the default.\n\nIf you have some components which are important to you, we can think about\nhow ```CompatibleHardware``` property for those can look like.\n\nLet me know, and i can start editing those configs and include those as part of the examples in the commit message.\n\nThen we can arrive at a point where you can configure the option and have all the needed configs available for the boards you are using.\n\nSo the option will not be useless to you and maybe it can even speed up your workflow for testing EM configs (since there is less json for the EM to go through at runtime).\n\n\u003e Platforms are not fixed. Add in cards are added/removed all the time. We cannot be hardcoding a single config in EM. If you want to do that, phosphor-inventory is the tool to use for a \"I know all things about the config at compile time\" use cases.\n\nEM is about dynamic configuration. In a real-world use-case there are sometimes fixed platforms, but i do not want to use phosphor-inventory since EM (with dynamic configuration) already completely contains any use-case for static configuration.\n\nSo i see no real use-case for static configuration anymore since the performance impact is small when only a few jsons are parsed.\n\nMost platforms fall somewhere in the middle, where there is a known part (baseboard config, perhaps chassis config) and an unknown part (expansion slots, psu, ...).\n\nTo provide the optimal solution we aim to deploy all configurations which could ever be useful for the boards supported by the BMC fw image, and none of the configurations which we are certain will never be used.",
      "parentUuid": "02cb8018_c6db359d",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f94fc154_475496c2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-12-13T00:48:01Z",
      "side": 1,
      "message": "\u003e  In such a layer it makes sense to have such an option since we know all system configurations we are building the image for.\n\nSorry, missed this response.  All of that is great, but what I don\u0027t understand is why we\u0027re checking things in upstream to support your downstream?  I\u0027m open to it, but removing all the configs except for the ones you \"vet\" is a trivial change to make in a meta layer with an RM call and adding back the files you care about.  There\u0027s no need for anything in the repo itself to accomplish this.  If meta layer owners want to do that, that\u0027s fine, and FWIW, my employer does it every day (in our downstream) for every EM enabled platform they use without needing anything upstream.\n\nI understand that static use cases are a thing, and EM is here to support if we can, but I don\u0027t want to take ownership of everyones static config, because I don\u0027t think it\u0027s maintainable across industry (hence why we built EM in the first place).\n\n\n\u003e To provide the optimal solution we aim to deploy all configurations which could ever be useful for the boards supported by the BMC fw image, and none of the configurations which we are certain will never be used.\n\nThis kind of statement I can get behind, but that\u0027s not what this patch does.  It segments by company/arbitrary guidelines, not something like \"This includes PCIe, so include all the PCIe devices\" or \"This includes CRPS connectors, so include CRPS PSUs\".  Keep in mind that a number of configurations are possible through expanders, switches, and port changers that make this list essentially infinite except for the baseboard case you mentioned.  If we want to solve the \"I don\u0027t want to carry other baseboards on my baseboard\" problem here, I\u0027m open to it.  For pretty much everything else, if there\u0027s a way to wire that component up, EM needs to support it by default, and I don\u0027t want to maintain a list of \"Alexander (and presumably 9elements) has vetted this config\" here.  That\u0027s something to do in meta-9elements.",
      "parentUuid": "e0c2ed5c_2134f096",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7ce0c3f5_0ab73daf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 38
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-01-05T11:02:37Z",
      "side": 1,
      "message": "\u003e is a trivial change to make in a meta layer with an RM call and adding \nback the files you care about.  There\u0027s no need for anything in the repo\n itself to accomplish this.  If meta layer owners want to do that, \nthat\u0027s fine, and FWIW, my employer does it every day (in our downstream)\n for every EM enabled platform they use without needing anything \nupstream.\n\nI don\u0027t think messing with installed files is a proper usage, neither in meta layers nor in downstream. EM repo already contains the needed files so there is no need to change anything there.\n\nIMO the right solution would be to simply configure the upstream project.\n\n\u003e If we want to solve the \"I don\u0027t want to carry other baseboards on my \nbaseboard\" problem here, I\u0027m open to it.  For pretty much everything \nelse, if there\u0027s a way to wire that component up\n\nThe primary motivation for dropping unused configs is space and runtime savings.\n\nIf we can only drop baseboard configs then the savings will be small and not meaningful / worthwhile.\n\nTherefore it does not make sense for me to continue working on this idea.",
      "parentUuid": "f94fc154_475496c2",
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1fec691e_00b9deb5",
        "filename": "configurations/tyan/tyan_s8030_baseboard.json",
        "patchSetId": 38
      },
      "lineNbr": 2,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-06-24T17:14:29Z",
      "side": 1,
      "message": "I have one of these boards that I use regularly for testing.  This would now cause all other configs to no longer install in that build?",
      "range": {
        "startLine": 2,
        "startChar": 27,
        "endLine": 2,
        "endChar": 37
      },
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f782a5dd_9c24497e",
        "filename": "configurations/tyan/tyan_s8030_baseboard.json",
        "patchSetId": 38
      },
      "lineNbr": 2,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-06-26T10:20:07Z",
      "side": 1,
      "message": "The change in the configuration json has no effect unless the meson option is configured to something other than the default value.",
      "parentUuid": "1fec691e_00b9deb5",
      "range": {
        "startLine": 2,
        "startChar": 27,
        "endLine": 2,
        "endChar": 37
      },
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38aa01eb_e935d066",
        "filename": "docs/compatible_hardware.md",
        "patchSetId": 38
      },
      "lineNbr": 29,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-06-12T18:14:25Z",
      "side": 1,
      "message": "There\u0027s any number of add in cards that could be plugged into this baseboard?  How is that supposed to work if we haven\u0027t marked all of them as compatible?",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 29,
        "endChar": 0
      },
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09a9d132_366460ee",
        "filename": "docs/compatible_hardware.md",
        "patchSetId": 38
      },
      "lineNbr": 29,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-06-13T08:48:42Z",
      "side": 1,
      "message": "Determining the compatibility and figuring out a schema there is an open issue that will require some consideration to get right. \n\nIf a type of add-in card is not yet covered in our naming scheme then we can just go with ```\"CompatibleHardware\": \"\"``` as documented.\n\nIn that case it will be installed no matter the value of the meson option and there is no way to opt out of it.\n\nPeople who want to avoid installing some configuration file must then figure out which type of hardware a configuration file is for and then add the ```CompatibleHardware``` appropriately.\n\n\n\u003e How is that supposed to work if we haven\u0027t marked all of them as compatible?\n\nThat\u0027s one of the reasons for why the meson option is a list of regexes.\nIt should be easy to configure it correctly without too much investigation.\n\nFor example when going with some product listing like \nhttps://www.mitaccomputing.com/en/spec/Barebones/TS70B8056_B8056T70V8E6HR-2T-HE-TU\n\nwe see it has\n- SATA\n- NVMe\n- hot-swap 8056 fans\n- CRPS PSU\n- PCIe\n- ...\n\nI\u0027m not sure if SATA does support any kind of management so we could go with an initial value for the meson option of ```nvme-* psu-crps-* tyan-*```\n\nThere is some leeway in this feature for how far one wants to go with determining compatibility. \n\nWe can start out by looking into the baseboard compatibility which is easy to determine. So that is phase 1.\n\nThen perhaps look into power supplies. Should also be easy to determine the compatibility there.\n\nCovering baseboards and power-supplies will already go a long way.",
      "parentUuid": "38aa01eb_e935d066",
      "range": {
        "startLine": 25,
        "startChar": 0,
        "endLine": 29,
        "endChar": 0
      },
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e9e8269f_ed05efdb",
        "filename": "meson.options",
        "patchSetId": 38
      },
      "lineNbr": 41,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2025-06-12T18:30:00Z",
      "side": 1,
      "message": "How does is this value get maintained as we add components?  Every time we add a pcie add in card, are we going to ask every platform maintainer with a pcie port on their system to update their regex?  That seems like a lot of effort for very little payoff.",
      "range": {
        "startLine": 41,
        "startChar": 18,
        "endLine": 41,
        "endChar": 126
      },
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "649ba60b_2911b9b9",
        "filename": "meson.options",
        "patchSetId": 38
      },
      "lineNbr": 41,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-06-13T11:35:35Z",
      "side": 1,
      "message": "That\u0027s why it is a list of regex and not plain strings ðŸ˜Š.\n\nIf one wants to support all PSU, go with ```psu-*```\n\nIf one wants to support only the CRPS PSU, go with ```psu-crps```\n\nIf one wants to support all the pcie hardware, go with ```pcie-*```\n\nSo there is a choice for the yocto layer maintainer in how fine-grained they want to configure this.\n\nNow the time where someone may need to adjust their regex list is when we annotate a new category of hardware. In that case the config would no longer be installed automatically.\n\nFor example if we start with the baseboards, my regex would look something like ```tyan-*```. Then at a later state we may start evaluating the PSU compatibility and i may need to adjust the regex to be like ```tyan-* psu-*```.\n\nI would assume anyone using this feature to fine-grain pick their configuration will be able to keep up with those changes.\n\nFor people who don\u0027t care and just want to have support support for everything they can always leave the meson option as default.",
      "parentUuid": "e9e8269f_ed05efdb",
      "range": {
        "startLine": 41,
        "startChar": 18,
        "endLine": 41,
        "endChar": 126
      },
      "revId": "3d74e5ce769bc1fc81598f8171bc8f92b288529c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}