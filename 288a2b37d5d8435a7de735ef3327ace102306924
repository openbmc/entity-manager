{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8c9a20e8_c3c6de09",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-04-09T07:37:46Z",
      "side": 1,
      "message": "Tested?  Looking at this, I wouldn\u0027t expect the FRU-device BOARD_MANUFACTURE_DATE and the BuildDate strings to have the same schema.  I suspect some amount of conversion is going to be required.",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d0033ba_214cbe09",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1001892
      },
      "writtenOn": "2024-04-09T08:54:40Z",
      "side": 1,
      "message": "Sorry I didn\u0027t notice this, they have different format.\nfru-device displays \"2024-03-28 - 06:06:00 UTC\" on BOARD_MANUFACTURE_DATE.\n\nShould we modify the format in fru_util.cpp to conform to the BuildDate format?",
      "parentUuid": "8c9a20e8_c3c6de09",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aff9c016_58e837d9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-04-09T19:27:45Z",
      "side": 1,
      "message": "answered in more detail on https://gerrit.openbmc.org/c/openbmc/entity-manager/+/70690\n\nI think we should change fru_util AND change the definition of BuildDate.",
      "parentUuid": "8d0033ba_214cbe09",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a062a6e1_4bbbfaac",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-04-12T15:47:30Z",
      "side": 1,
      "message": "\u003e Sorry I didn\u0027t notice this, they have different format.\nfru-device displays \"2024-03-28 - 06:06:00 UTC\" on BOARD_MANUFACTURE_DATE.\n\nIs this because fru-device is doing conversions or because of the data in the IPMI eeprom not being the right format?\n\n```\n                auto bytes \u003d std::strftime(timeString.data(), timeString.size(),\n                                           \"%Y-%m-%d - %H:%M:%S UTC\", \u0026fruTime);\n...\n\n                result[\"BOARD_MANUFACTURE_DATE\"] \u003d\n                    std::string_view(timeString.data(), bytes);\n```\n\nWe can make a trivial fix here to do ISO 8601 format, right?",
      "parentUuid": "aff9c016_58e837d9",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1282a732_0e98f078",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-04-12T16:06:51Z",
      "side": 1,
      "message": "\u003e \u003e Sorry I didn\u0027t notice this, they have different format.\n\u003e fru-device displays \"2024-03-28 - 06:06:00 UTC\" on BOARD_MANUFACTURE_DATE.\n\u003e \n\u003e Is this because fru-device is doing conversions or because of the data in the IPMI eeprom not being the right format?\n\nThe former.\n\n\u003e \n\u003e ```\n\u003e                 auto bytes \u003d std::strftime(timeString.data(), timeString.size(),\n\u003e                                            \"%Y-%m-%d - %H:%M:%S UTC\", \u0026fruTime);\n\u003e ...\n\u003e \n\u003e                 result[\"BOARD_MANUFACTURE_DATE\"] \u003d\n\u003e                     std::string_view(timeString.data(), bytes);\n\u003e ```\n\u003e \n\u003e We can make a trivial fix here to do ISO 8601 format, right?\n\nIf we\u0027re going to make a change, lets just make it epoch microseconds, so we match the rest of the system EpochTime, PEL Entry.Timestamp, LastRebootTime etc.",
      "parentUuid": "a062a6e1_4bbbfaac",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4bf31816_66db13b5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-04-12T16:28:14Z",
      "side": 1,
      "message": "That also requires changes in openpower-vpd-parser and likely phosphor-host-ipmid (as there is both references in the repo and a whole bunch of config-yaml files in openbmc/openbmc).  I don\u0027t see why we should require that wholesale change as a pre-requisite when only fru-device is doing it differently.",
      "parentUuid": "1282a732_0e98f078",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb2bf289_cdb096f0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-04-12T16:34:30Z",
      "side": 1,
      "message": "\u003e That also requires changes in openpower-vpd-parser\n\nWhy is openpower-vpd-parser exposing a FruDevice specific interface?  Do you have a pointer to the code handy. I\u0027m not seeing it.\n\nhttps://github.com/search?q\u003drepo%3Aopenbmc%2Fopenpower-vpd-parser%20BOARD_MANUFACTURE_DATE\u0026type\u003dcode\n\n\u003e and likely phosphor-host-ipmid (as there is both references in the repo and a whole bunch of config-yaml files in openbmc/openbmc).  I don\u0027t see why we should require that wholesale change as a pre-requisite when only fru-device is doing it differently.\n\n\u003e only fru-device is doing it differently\n\nIn this patch we\u0027re talking about an interface literally called xyz.openbmc_project.FruDevice......  I\u0027m very confused why any other daemon duplicated it.",
      "parentUuid": "4bf31816_66db13b5",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2216bc7b_1d5de844",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-04-12T16:36:25Z",
      "side": 1,
      "message": "openpower-vpd-parser is exposing the Asset.BuildDate that we are also trying to expose via entity-manager.  That is the property you suggested (at a dbus level) needed to be transformed from ISO 8601 to epoch-time, isn\u0027t it?\n\n\u003e ... and change phosphor-dbus-interface build date to match (and use linux epoch microseconds).",
      "parentUuid": "eb2bf289_cdb096f0",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76d6b5c5_77814e7e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-04-12T16:39:04Z",
      "side": 1,
      "message": "If you want to change fru-device to expose epoch-time for this, fine I guess.  That seems like a bit of pointless transformation because then we need entity-manager to (for now) un-transform it.  Since it is all in the same repository, it seems like a 1-2 line change to have it generate ISO 8601 format and everything else proposed here just works as-is.",
      "parentUuid": "2216bc7b_1d5de844",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "01cfcd79_6fbd3501",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-04-12T17:18:26Z",
      "side": 1,
      "message": "\u003e That is the property you suggested (at a dbus level) needed to be transformed from ISO 8601 to epoch-time, isn\u0027t it?\n\nACK, now I understand you comment.  The root of my thought was that Fru-Device should just expose an Epoch, to avoid the arbitrariness of ISO8061 (for example, I wouldn\u0027t expect fru-device to be timezone aware).  I was just suggesting that if we\u0027re going to make changes to several daemons, we might use this as an opportunity to make the dbus interfaces more consistent, especially considering the changes to each repo are relatively straightforward.\n\nYes, just having fru-device expose an ISO8061 date is another way this could be solved.  I don\u0027t like that Entity-manager is now relying on FRU device to publish a correct ISO8061 interface so that EM can expose a correct Dbus interface.\n\nWhereas every possible value of epoch can be converted to an correct ISO8061 date in whatever way a daemon requires.  There\u0027s no arbitrariness around timezones or formats.\n\nFWIW, as I look closer, the description of BuildDate isn\u0027t correct to ISO8601, right?\n```\nThe date of item manufacture in ISO 8601 format, either as YYYYMMDD or YYYYMMDDThhmmssZ.  Where \u0027T\u0027 is a literal character to separate date fields from time and \u0027Z\u0027 is a literal character to indicate UTC.\n```\n\nISO8601 is\nYYYY-MM-DD\nor\nYYYY-MM-DDThh:mmZ\n\nRight?  (I will admit, I\u0027m not an expert here).\n\nPresumably the next step is to pump this into Redfish Assembly-\u003eProductionDate property, which imposes other arbitrary requirements beyond ISO8601, so Redfish has to parse the ISO8061 date anyway so we can spit it out as the spec requires.  I suspect EPOCH would be easier considering we already have a bunch of unit tested utility functions for going epoch -\u003e (redfish ISO8061-like date).\n\nIf the problem is that phosphor-host-ipmid need to change, I\u0027m happy to push the commit for you.\n\nhttps://github.com/openbmc/phosphor-host-ipmid/blob/337a0978efd615ef27ff1ba8241974a7c020d845/ipmi_fru_info_area.cpp#L234\n\nNeeds timeStringToRaw removed and replaced with std::get_if\u003cuint64_t\u003e(iter-\u003esecond);\n\nLooking at openpower-vpd-parser, it looks like BuildDate there is a specific Record within their VPD?  so I don\u0027t think the json needs to change https://github.com/openbmc/openpower-vpd-parser/blob/4788e1ba0a00d504e1fcdb34eb9356e22850de18/config/ibm/vpd_inventory.json#L20\n\nAnd FWIW, it already doesn\u0027t follow what phosphor dbus interfaces defines:\n```\n// MB is BuildDate, represent as\n// 1997-01-01-08:30:00\n```\n\nSo lets just make this consistent and correct.\n\n\nJust to reiterate my first comment so it doesn\u0027t get lost in the noise, the main problem with this commit is that it was pushed without a Testing statement, and testing clearly hasn\u0027t been done.  We shouldn\u0027t be finding obvious interface bugs in a code review claiming to be done.",
      "parentUuid": "76d6b5c5_77814e7e",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e594b98_2ae11064",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-04-12T17:41:55Z",
      "side": 1,
      "message": "ISO8601 allows either YYYY-MM-DD or YYYYMMDD (according to wikipedia as I haven\u0027t personally paid for the spec).  I chose the YYYYMMDDThhmmssZ one for the following reasons:\n\n- It was compatible with YYYYMMDD that was in the code before I added the time-portion.\n- Z so we didn\u0027t have to mess with timezones.\n\nIf you want to go ahead and make the changes to epoch-time, that\u0027s fine.  I\u0027m not sure how we deal with the openpower one if they\u0027re already not following the specification.  I guess they\u0027d have to add parsing.",
      "parentUuid": "01cfcd79_6fbd3501",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "40eaf037_51714f4b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-04-09T19:29:44Z",
      "side": 1,
      "message": "Missing testing and code doesn\u0027t produce a correct result on dbus.",
      "revId": "288a2b37d5d8435a7de735ef3327ace102306924",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}