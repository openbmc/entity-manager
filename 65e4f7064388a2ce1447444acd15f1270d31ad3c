{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d3d53ee0_00ca868e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 1002345
      },
      "writtenOn": "2025-06-02T06:43:56Z",
      "side": 1,
      "message": "Hello Andrew,\n\nThank you for your comment.",
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89a290f3_6732df44",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-05-30T06:20:56Z",
      "side": 1,
      "message": "By describing the configuration in EM we\u0027re trying to locate the physical device. Maybe Bus, Port, Configuration and Interface might be more helpful here? The kernel will automatically create an interface when it sees the MCTP interface descriptor. The interface can be located by looking under the net/ subdirectory:\n\n```\n# ls -1d /sys/bus/usb/devices/1-1/1-1:1.0/net/*\n/sys/bus/usb/devices/1-1/1-1:1.0/net/mctpusb0\n```\n\nThis is essentially:\n\n```\n/sys/bus/usb/devices/${Bus}-${Port}/${Bus}-${Port}:${Configuration}-${Interface}/net/...\n```",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bebfd5fc_e7805ec0",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1002345
      },
      "writtenOn": "2025-06-02T06:43:56Z",
      "side": 1,
      "message": "Interface name assigned to USB devices from kernel is indeterministic in nature i.e for x-y.z bus-port.path, it\u0027s not necessary that mctpusbX would always be assigned since its completely based on first come first serve basis for usb devices.\n\nfor eg : if we have two USB devices as 1-1 and 1-2 path, and we attach first USB device (1-1) and later the second one (1-2), interface names may get assigned as mctpusb0 and mctpusb1 for first and second device respectively. Since USB is hot pluggable in nature, we can detach and reattach devices and this time if in reverse sequence i.e second device followed by first, then interface name for second device would end up as mctpusb0 while for the first usb device as mctpusb1.\n\n \nRight now we don\u0027t have a proper mechanism in upstream to map the USB device\u0027s bus-port.path to its right interface name.\n\nI agree at kernel sysfs path this data will exist but this too would be indeterministic, thus exposing BUS, PORT, CONFIGURATION etc for usb device on EM configuration might not be directly feasible.\n\nBesides this patch aims to handle dynamic EID assignment to the mctp usb devices which as in whole doesn\u0027t necessarily requires such data from MCTP Reactor end.\n\nBut I completely agree with you to expose these details of devices once we are looking into integrating Static EID assignment to the USB endpoints.",
      "parentUuid": "89a290f3_6732df44",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab25479a_977613db",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-06-03T00:25:00Z",
      "side": 1,
      "message": "\u003e Interface name assigned to USB devices from kernel is indeterministic in nature i.e for x-y.z bus-port.path, it\u0027s not necessary that mctpusbX would always be assigned since its completely based on first come first serve basis for usb devices.\n\nYes, this is why it\u0027s not appropriate to specify the interface name in an EM schema IMO.\n\n\u003e Right now we don\u0027t have a proper mechanism in upstream to map the USB device\u0027s bus-port.path to its right interface name.\n\nI gave you one above. Use the bus, port, config and interface values to locate the device in sysfs, then look at the directory name under `net/`. From there you just need to take the basename. Expanding on my example above:\n\n```\n# basename /sys/bus/usb/devices/1-1/1-1:1.0/net/*\nmctpusb0\n```\n\n\u003e I agree at kernel sysfs path this data will exist but this too would be indeterministic\n\nOne concern here is a stable alias for the bus, but beyond that the port topology is stable.\n\n\u003e Besides this patch aims to handle dynamic EID assignment to the mctp usb devices which as in whole doesn\u0027t necessarily requires such data from MCTP Reactor end.\n\nIf that\u0027s the case, why are you proposing an EM schema (I\u0027m the author of `mctpreactor`)? We can have mctpreactor respond to udev or netlink events to automatically set up the endpoint dynamically.",
      "parentUuid": "bebfd5fc_e7805ec0",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e14056eb_3f50adab",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000338
      },
      "writtenOn": "2025-06-05T10:20:17Z",
      "side": 1,
      "message": "\u003e \u003e Interface name assigned to USB devices from kernel is indeterministic in nature i.e for x-y.z bus-port.path, it\u0027s not necessary that mctpusbX would always be assigned since its completely based on first come first serve basis for usb devices.\n\u003e \n\u003e Yes, this is why it\u0027s not appropriate to specify the interface name in an EM schema IMO.\n\u003e \n\u003e \u003e Right now we don\u0027t have a proper mechanism in upstream to map the USB device\u0027s bus-port.path to its right interface name.\n\u003e \n\u003e I gave you one above. Use the bus, port, config and interface values to locate the device in sysfs, then look at the directory name under `net/`. From there you just need to take the basename. Expanding on my example above:\n\u003e \n\u003e ```\n\u003e # basename /sys/bus/usb/devices/1-1/1-1:1.0/net/*\n\u003e mctpusb0\n\u003e ```\n\u003e \n\u003e \u003e I agree at kernel sysfs path this data will exist but this too would be indeterministic\n\u003e \n\u003e One concern here is a stable alias for the bus, but beyond that the port topology is stable.\n\u003e\n\nWould it be best that we let something external do that? Something like a udev rule that sets  an altname to the net i/f via a udev rule, (via something like: `ip link property add dev $env{INTERFACE} altname mctpusb\u003cbus_id\u003e-\u003cport_path\u003e-\u003ccfg\u003e-\u003cintf\u003e`\n\nThe EM config can continue to use the alt interface name rather than having to piece that together from sysfs.\n\n\u003e \u003e Besides this patch aims to handle dynamic EID assignment to the mctp usb devices which as in whole doesn\u0027t necessarily requires such data from MCTP Reactor end.\n\u003e \n\u003e If that\u0027s the case, why are you proposing an EM schema (I\u0027m the author of `mctpreactor`)? We can have mctpreactor respond to udev or netlink events to automatically set up the endpoint dynamically.\n\nWe need an EM schema for 1) creating the association between the MCTP endpoint objects and the config and 2) the aim is still to get to static endpoints in the future.",
      "parentUuid": "ab25479a_977613db",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "20573f66_26b96b8b",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-06-05T23:55:18Z",
      "side": 1,
      "message": "\u003e Would it be best that we let something external do that? Something like a udev rule that sets an altname to the net i/f via a udev rule, (via something like: ip link property add dev $env{INTERFACE} altname mctpusb\u003cbus_id\u003e-\u003cport_path\u003e-\u003ccfg\u003e-\u003cintf\u003e\n\nI feel that\u0027s moving the problem rather than removing it. Now you need to coordinate the custom udev rule with the EM configuration, and you still end up needing to know the details anyway with the scheme you\u0027ve proposed.\n\nEM configs are about describing hardware and their relationships. I don\u0027t see any reason not to continue that by describing Bus/Port/Configuration/Interface for USB devices directly.\n\n\u003e We need an EM schema for 1) creating the association between the MCTP endpoint objects and the config and 2) the aim is still to get to static endpoints in the future.\n\nUnderstood, however, EM configs that lack any hardware context are detached in a way that makes them a bit meaningless. However, with the scheme discussed above we can fix that.",
      "parentUuid": "e14056eb_3f50adab",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0acc7295_7fb6a657",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000338
      },
      "writtenOn": "2025-06-06T03:50:00Z",
      "side": 1,
      "message": "\u003e I feel that\u0027s moving the problem rather than removing it. Now you need to coordinate the custom udev rule with the EM configuration, and you still end up needing to know the details anyway with the scheme you\u0027ve proposed.\n\u003e \n\u003e EM configs are about describing hardware and their relationships. I don\u0027t see any reason not to continue that by describing Bus/Port/Configuration/Interface for USB devices directly.\n\u003e\n\nOK, that is fair. We can update this config to include that information and make the corresponding reactor changes to consume that info, get the right interface name from sysfs and proceed to use that to call into mctpd. Once that is done, would this and the corresponding Reactor change be good to go?\n\n\u003e \u003e We need an EM schema for 1) creating the association between the MCTP endpoint objects and the config and 2) the aim is still to get to static endpoints in the future.\n\u003e \n\u003e Understood, however, EM configs that lack any hardware context are detached in a way that makes them a bit meaningless. However, with the scheme discussed above we can fix that.\n\nAck.",
      "parentUuid": "20573f66_26b96b8b",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05ea521a_e520a216",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000009
      },
      "writtenOn": "2025-06-06T07:20:43Z",
      "side": 1,
      "message": "\u003e OK, that is fair. We can update this config to include that information and make the corresponding reactor changes to consume that info, get the right interface name from sysfs and proceed to use that to call into mctpd. Once that is done, would this and the corresponding Reactor change be good to go?\n\nIMO yes, but I\u0027m not an EM maintainer, so you\u0027ll need to convince them too üòä\n\nFWIW note the implementation for resolving the interface name of `MCTPI2CTarget`s:\n\nhttps://gerrit.openbmc.org/plugins/gitiles/openbmc/dbus-sensors/+/02c4366be0eb2409c81784c989dfb690cd41af58/src/mctp/MCTPEndpoint.cpp#397",
      "parentUuid": "0acc7295_7fb6a657",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e94e18a6_55ea16a1",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1002305
      },
      "writtenOn": "2025-06-11T11:21:35Z",
      "side": 1,
      "message": "@andrew@codeconstruct.com.au, this is the new EM schema which takes in the RootHubPath like `\"/sys/devices/platform/ahb/1e6a3000.usb\"` and deduces the deterministic busnum attribute in the reactor. \nExample EM schema would look like\n```\n\"Exposes\": [\n        {\n\t     \"RootHubPath\": \"/sys/devices/platform/ahb/1e6a3000.usb\",\n    \t     \"Port\": \"1.2.5\",\n             \"Configuration\": \"1\",\n             \"InterfaceNum\": ‚Äú0‚Äù,\n\t      \"Name\": \"mctpusb_x‚Äù,\n    ‚ÄÇ‚ÄÇ‚ÄÇ‚ÄÇ‚ÄÇ\"Type\": \"MCTPUSBDevice\"\n        }\n    ]\n```\nReactor Changes for your reference: https://gerrit.openbmc.org/c/openbmc/dbus-sensors/+/80452",
      "parentUuid": "05ea521a_e520a216",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4db6db86_563631af",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2025-12-15T18:07:00Z",
      "side": 1,
      "message": "@andrew@codeconstruct.com.au any furthe comments here? I\u0027ve added a topic to all the related patches that I\u0027m testing on an upstream Nvidia platform - https://gerrit.openbmc.org/q/topic:%22mctp-usb-config%22 .",
      "parentUuid": "e94e18a6_55ea16a1",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5f4409e5_6e1562f3",
        "filename": "schemas/mctp.json",
        "patchSetId": 8
      },
      "lineNbr": 53,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2025-12-23T14:38:23Z",
      "side": 1,
      "message": "Resolving this based on the above comment.",
      "parentUuid": "4db6db86_563631af",
      "range": {
        "startLine": 50,
        "startChar": 1,
        "endLine": 53,
        "endChar": 18
      },
      "revId": "65e4f7064388a2ce1447444acd15f1270d31ad3c",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}