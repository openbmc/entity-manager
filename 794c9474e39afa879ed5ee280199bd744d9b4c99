{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "187845d4_550d6db5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 10,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-02-02T04:27:54Z",
      "side": 1,
      "message": "Are there cases where the cleanup is not done? What\u0027s better about this `shared_ptr` approach?\n\nFrom my perspective, `shared_ptr` tends to make code less readable since it\u0027s harder to tell when the destructor will be called.",
      "range": {
        "startLine": 9,
        "startChar": 58,
        "endLine": 10,
        "endChar": 32
      },
      "revId": "794c9474e39afa879ed5ee280199bd744d9b4c99",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f21af86_899e2d26",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 10,
      "author": {
        "id": 1000885
      },
      "writtenOn": "2026-02-02T19:27:42Z",
      "side": 1,
      "message": "I think everything is cleaned up properly right now. This change was made to make sure that we don\u0027t continue using the fd after we close it already.\n\n- https://gerrit.openbmc.org/c/openbmc/entity-manager/+/87122\n\nWe could technically also just pass in the reference of the fd and set it to -1 after we close it, however, that can be undefined behavior when it goes out of scope.",
      "parentUuid": "187845d4_550d6db5",
      "range": {
        "startLine": 9,
        "startChar": 58,
        "endLine": 10,
        "endChar": 32
      },
      "revId": "794c9474e39afa879ed5ee280199bd744d9b4c99",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "92efa4df_3f523c05",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 10,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-02-03T01:54:29Z",
      "side": 1,
      "message": "\u003e This change was made to make sure that we don\u0027t continue using the fd after we close it already.\n\n\nThe intention makes sense to me, but can it be done in a simpler way?\nI agree that some kind of cleanup is needed since for example `writeFRU` has a lot of `close(...)` calls and some code path could slip through without closing the file.\n\n\nWhat about something like this:\n\n```\nstd::ifstream file(\"/sys/.../eeprom\"); // or similar code\nread_fru(file);\nfile.close();\n```\n\nThat avoids the complexity of `shared_ptr` and keeps things simple.\n\nAnother way to solve it could be to make an enclosing scope\n```\n{\n  std::ifstream file(\"/sys/.../eeprom\"); // or similar code\n  read_fru(file);\n  file.close();\n}\n```\nwhich would prevent variables from being visible to the latter parts of a function.\n\nWhat\u0027s your take on these alternative methods to fix it?",
      "parentUuid": "2f21af86_899e2d26",
      "range": {
        "startLine": 9,
        "startChar": 58,
        "endLine": 10,
        "endChar": 32
      },
      "revId": "794c9474e39afa879ed5ee280199bd744d9b4c99",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "68a67cce_917faf84",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 13,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2026-02-02T04:27:54Z",
      "side": 1,
      "message": "Can you put a `Tested` statement to know how you tested this change.",
      "revId": "794c9474e39afa879ed5ee280199bd744d9b4c99",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "927e7c95_e9e566b7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 13,
      "author": {
        "id": 1000885
      },
      "writtenOn": "2026-02-02T19:27:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "68a67cce_917faf84",
      "revId": "794c9474e39afa879ed5ee280199bd744d9b4c99",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}