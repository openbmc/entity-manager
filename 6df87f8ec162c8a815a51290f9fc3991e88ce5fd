{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "bdf3c155_53388dab",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2023-05-26T14:18:53Z",
      "side": 1,
      "message": "maybe its needed for ina219 which is not known from devicetree?\n\nbut if its in entity-manager, then it can also be in devicetree right?\n\nif you have full devicetree, this feature is not needed as the shunt_resistor seems to be able to be set in devicetree.\n\nDocumentation/devicetree/bindings/hwmon/ti,ina2xx.yaml \n\nexamples:\n  - |\n    i2c {\n        #address-cells \u003d \u003c1\u003e;\n        #size-cells \u003d \u003c0\u003e;\n\n        power-sensor@44 {\n            compatible \u003d \"ti,ina220\";\n            reg \u003d \u003c0x44\u003e;\n            shunt-resistor \u003d \u003c1000\u003e;\n        };\n    };\n\n------------------------------\napologies if i misunderstood anything. i dont have experience with this sensor.",
      "revId": "6df87f8ec162c8a815a51290f9fc3991e88ce5fd",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "61ee9c58_4a9e77dc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000559
      },
      "writtenOn": "2023-06-28T05:06:14Z",
      "side": 1,
      "message": "This device is not in device tree. Entity Manager support discover hardware at run time dynamically and binds the device driver after successfully probe.",
      "parentUuid": "bdf3c155_53388dab",
      "revId": "6df87f8ec162c8a815a51290f9fc3991e88ce5fd",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eca44650_e85aa0cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000559
      },
      "writtenOn": "2023-06-28T05:08:54Z",
      "side": 1,
      "message": "Device supported by entity-manager: https://github.com/openbmc/entity-manager/blob/master/src/devices.hpp#L68",
      "parentUuid": "61ee9c58_4a9e77dc",
      "revId": "6df87f8ec162c8a815a51290f9fc3991e88ce5fd",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3b0d5a19_903e807c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000900
      },
      "writtenOn": "2023-07-12T00:22:18Z",
      "side": 1,
      "message": "Yes, as Zhikui explained, this whole subsystem of Entity Manager is to support devices that need to be dynamically added because they don\u0027t exist when the BMC powers up for whatever reason. As far as I could tell, there is no way to merge attributes from the devicetree with dynamically added devices at the same address (i.e. it would be nice to describe this sensor in the devicetree like you mention and then have the shunt-resistor automatically applied when EM binds the device - but I don\u0027t think that\u0027s possible). So I think we still need this patch.",
      "parentUuid": "eca44650_e85aa0cb",
      "revId": "6df87f8ec162c8a815a51290f9fc3991e88ce5fd",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b794d952_20da0fe7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2023-07-14T10:07:52Z",
      "side": 1,
      "message": "what about devicetree overlays ? isn\u0027t that a better way to go about dynamically adding devices? the ways in which devices can be added via sysfs are quite limited and not all properties which are in devicetree are configurable via sysfs. adding devices via EM would be duplicating that effort, and could never go as far.\n\nEM will never have as much control over the devices as the kernel. why can\u0027t EM just load a devicetree overlay whenever host is powered on, for example?",
      "parentUuid": "3b0d5a19_903e807c",
      "revId": "6df87f8ec162c8a815a51290f9fc3991e88ce5fd",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c1b1b05_f135b8c4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000900
      },
      "writtenOn": "2023-07-14T19:32:46Z",
      "side": 1,
      "message": "Just did some searching about this, and it seems that\u0027s exactly what EM used to do. (Hence the name of this file `overlay.cpp`.) However, it was removed and replaced with sysfs binding because there is no support in the kernel for userspace to trigger the overlay loading. I guess OpenBMC previously was carrying some patches to provide that userspace DTS overlay interface, but we didn\u0027t want to carry that any more.\n\nIn fact I found in discord that someone else wanted to configure the INA219 shunt_resistor (https://discord.com/channels/775381525260664832/819741065531359263/837777465932906546). I will explore using PowerScaleFactor instead of this change to see if it works well enough.",
      "parentUuid": "b794d952_20da0fe7",
      "revId": "6df87f8ec162c8a815a51290f9fc3991e88ce5fd",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3dcd77b_32df70ea",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000559
      },
      "writtenOn": "2023-07-31T23:22:04Z",
      "side": 1,
      "message": "This approach lgtm. I will +1 but wait for update from your experiment",
      "parentUuid": "5c1b1b05_f135b8c4",
      "revId": "6df87f8ec162c8a815a51290f9fc3991e88ce5fd",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}